CREATE DATABASE mystudylife;

USE mystudylife;

CREATE TABLE users (
id INT(9) NOT NULL AUTO_INCREMENT,
email VARCHAR(100) NOT NULL,
password VARCHAR(100) NOT NULL,
name VARCHAR(100) NOT NULL,
creationDate DATETIME NOT NULL,
remember_token VARCHAR(100),
UNIQUE (email),
PRIMARY KEY (id)
);

CREATE TABLE school_years (
id INT(12) NOT NULL AUTO_INCREMENT,
owner INT(9) NOT NULL,
name VARCHAR(100) NOT NULL,
start_date DATE NOT NULL,
end_date DATE NOT NULL,
UNIQUE (owner, name),
PRIMARY KEY (id),
FOREIGN KEY (owner) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE school_terms (
id INT(12) NOT NULL AUTO_INCREMENT,
year INT(12) NOT NULL,
name VARCHAR(100) NOT NULL,
start_date DATE NOT NULL,
end_date DATE NOT NULL,
UNIQUE (year, name),
PRIMARY KEY (id),
FOREIGN KEY (year) REFERENCES school_years(id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE subjects (
id INT(12) NOT NULL AUTO_INCREMENT,
term INT(12) NOT NULL,
name VARCHAR(100) NOT NULL,
teacher VARCHAR(100),
UNIQUE (term, name),
PRIMARY KEY (id),
FOREIGN KEY (term) REFERENCES school_terms(id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE schedules (
id INT(24) NOT NULL AUTO_INCREMENT,
subject INT(12) NOT NULL,
building VARCHAR(30),
room VARCHAR(30),
day VARCHAR(30) NOT NULL,
start_time TIME NOT NULL,
end_time TIME NOT NULL,
PRIMARY KEY (id),
FOREIGN KEY (subject) REFERENCES subjects(id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE exams (
id INT(24) NOT NULL AUTO_INCREMENT,
subject INT(12) NOT NULL,
date DATE NOT NULL,
start_time TIME NOT NULL,
building VARCHAR(30),
room VARCHAR(30),
description VARCHAR(600),
PRIMARY KEY (id),
FOREIGN KEY (subject) REFERENCES subjects(id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE tasks (
id INT(24) NOT NULL AUTO_INCREMENT,
subject INT(12) NOT NULL,
due_date DATE NOT NULL,
title VARCHAR(100) NOT NULL,
description VARCHAR(600),
complete BOOL,
PRIMARY KEY (id),
FOREIGN KEY (subject) REFERENCES subjects(id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE change_password (
user INT(9) NOT NULL,
unique_key VARCHAR(32) UNIQUE,
PRIMARY KEY (user),
FOREIGN KEY (user) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE user_profile_picture (
user INT(9) NOT NULL,
url VARCHAR(100) NOT NULL,
PRIMARY KEY(user),
FOREIGN KEY (user) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE
);